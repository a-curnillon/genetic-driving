<!DOCTYPE html>
<html>

<head>

  <title>Genetic Driving</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="style.css">

</head>

<body>

  <table>

    <thead>
      <tr>
        <th colspan="12">
          <h1><span id="A">•</span> Project <span id="T">•</span> Genetic <span id="C">•</span> Driving <span id="G">•</span></h1>
        </th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td class="colored" colspan="4">Author :</td>
        <td class="centered" colspan="8"><div id="author"></div></td>
      </tr>
      <tr>
        <td class="colored" colspan="4">Date :</td>
        <td class="centered" colspan="8"><div id="date"></div></td>
      </tr>
      <tr>
        <td class="colored centered" colspan="12">
          Parameters <button id="buttonParam" onclick="clickParam()" type="button" value="up">&uarr;</button>
        </td>
      </tr>
      <tr>
        <td class="centered mid-colored paramMenu" colspan="4"><b>Play</b> / Pause</td>
        <td class="centered mid-colored paramMenu" colspan="8"><b>Normal</b> / debug</td>
      </tr>
      <tr>
        <td class="centered paramMenu" colspan="4">
          <input id="buttonPlayPause" type="checkbox" checked="true" onclick="clickPlayPause()"></input>
        </td>
        <td class="centered paramMenu" colspan="8">
          <input type="checkbox" checked="true" onclick="clickNormalDebug()"></input>
      </tr>
      <tr>
        <td class="centered mid-colored paramMenu" colspan="12">Mutation rate</td>
      </tr>
      <tr>
        <td class="centered paramMenu" colspan="12">
          <input type="range" min="0" step="0.01" max="1" value="0.2" class="slider" id="sliderMutation" onchange="slideChange()"><br>
          <span id="sliderValue">0.2</span>
        </td>
      </tr>
      <tr>
        <td class="colored centered" colspan="12">Simulation</td>
      </tr>
      <tr>
        <td class="centered no-margin" colspan="12"><div id="sketch-holder"></div></td>
      </tr>
      <tr>
        <td class="colored centered" colspan="12">
          Statistics <button id="buttonStats" onclick="clickStats()" type="button" value="up">&uarr;</button>
        </td>
      </tr>
      <tr>
        <td class="centered elemStats" colspan="12"><div><canvas id="myChart" width="400" height="400"></canvas></div></td>
      </tr>
    </tbody>

  </table>

  <script>

    function clickParam() {
      let elm = document.getElementById('buttonParam');
      if(elm.value == "up") {
        elm.value = "down";
        elm.innerHTML = "&darr;"
        let menuElement = document.getElementsByClassName('paramMenu');
        for (let i = 0; i < menuElement.length; i++) {
          menuElement[i].style.display = "none";
        }
      } else {
        elm.value = "up";
        elm.innerHTML = "&uarr;"
        let menuElement = document.getElementsByClassName('paramMenu');
        for (let i = 0; i < menuElement.length; i++) {
          menuElement[i].style.display = "table-cell";
        }
      }
    }

    function clickStats() {
      let elm = document.getElementById('buttonStats');
      if(elm.value == "up") {
        elm.value = "down";
        elm.innerHTML = "&darr;"
        let statElement = document.getElementsByClassName('elemStats');
        for (let i = 0; i < statElement.length; i++) {
          statElement[i].style.display = "none";
        }
      } else {
        elm.value = "up";
        elm.innerHTML = "&uarr;"
        let statElement = document.getElementsByClassName('elemStats');
        for (let i = 0; i < statElement.length; i++) {
          statElement[i].style.display = "table-cell";
        }
      }
    }

    function clickGenea() {
      let elm = document.getElementById('buttonGenea');
      if(elm.value == "up") {
        elm.value = "down";
        elm.innerHTML = "&darr;"
        let statElement = document.getElementsByClassName('elemGenea');
        for (let i = 0; i < statElement.length; i++) {
          statElement[i].style.display = "none";
        }
      } else {
        elm.value = "up";
        elm.innerHTML = "&uarr;"
        let statElement = document.getElementsByClassName('elemGenea');
        for (let i = 0; i < statElement.length; i++) {
          statElement[i].style.display = "table-cell";
        }
      }
    }

    function clickPlayPause() {
      if (gameState == 1) {
        gameState = 4;
      } else if (gameState == 4){
        gameState = 1;
      } else {
        document.getElementById('buttonPlayPause').checked = "true";
      }
    }

    function clickNormalDebug() {
      debugMode = !debugMode;
      if(debugMode == false) {
        for (let i = 0; i < cars.length; i++) {
          car.move(width/6 - this.w/2, tempPosTab[i]);
          console.log(tempCrashTab[i]);
          car.crashed = tempCrashTab[i];
        }
        for(let obstacle of obstacles) {
          let backdistance = obstacle.x + width/3;
          while(obstacle.x < backdistance) {
            obstacle.x++;
          }
        }
        isPlaying = true;
        startTime = Date.now()%120000;
      } else {
        tempPosTab = [];
        tempCrashTab = [];
        for (let car of cars) {
          tempPosTab.push(car.y);
          tempCrashTab.push(car.crashed);
        }
      }
    }

    function slideChange() {
      document.getElementById('sliderValue').innerHTML = document.getElementById('sliderMutation').value;
      mutationRate = document.getElementById('sliderMutation').value;
      console.log("Mutation Rate : " + mutationRate);
    }

  </script>

  <script type="module">

    import define from "./geneaGraph.js";
    import {Runtime, Library, Inspector} from "./runtime.js";
  
    const runtime = new Runtime();
    const main = runtime.module(define, Inspector.into(document.body));
  
  </script>

<script src="https://cdn.jsdelivr.net/npm/p5@1.3.1/lib/p5.js"></script>
  <script src="sketch.js"></script>
  <script src="htmlRequest.js"></script>
  <script src="setgame.js"></script>
  <script src="playgame.js"></script>
  <script src="gamearea.js"></script>
  <script src="boundaries.js"></script>
  <script src="obstacles.js"></script>
  <script src="variables.js"></script>
  <script src="cars.js"></script>
  <script src="ray.js"></script>
  <script src="neurons.js"></script>
  <script src="startgame.js"></script>
  <script src="functions.js"></script>
  <script src="clocks.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  <script src="stats.js"></script>
  <script src="start.js"></script>
  <script src="pauseGame.js"></script>
  <script src="dispScore.js"></script>
  <script src="geneticAlgorithm.js"></script>
  <script src="tree.js"></script>
  <script src="scoreboard.js"></script>
  <script src="AliveBoard.js"></script>

</body>

</html>
